<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Max Soccer ⚽ | Ambassador Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Orbitron',sans-serif;}
body{
  background:radial-gradient(circle at top,#1b1f4b,#070a1f);
  color:#fff;
  min-height:100vh;
}

/* HERO */
.hero{
  padding:4rem 2rem;
  text-align:center;
}
.hero h1{
  font-size:3rem;
  color:#ff0000;
  text-shadow:0 0 20px #ff0000;
  margin-bottom:0.5rem;
}
.hero p{
  max-width:700px;
  margin:auto;
  font-size:1.2rem;
  opacity:.9;
}

/* WALLET BALANCE */
.wallet{
  margin-top:1rem;
  font-size:1.3rem;
  color:#ff4d4d;
  font-weight:700;
  text-shadow:0 0 10px #ff4d4d;
}

/* GRID CARDS */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:2.5rem;
  padding:3rem;
  max-width:1400px;
  margin:auto;
}

/* CARD */
.card{
  background:rgba(255,255,255,.07);
  border-radius:25px;
  padding:2rem;
  text-align:center;
  backdrop-filter:blur(15px);
  box-shadow:0 15px 45px rgba(0,0,0,.5);
  transition:.4s;
  position:relative;
  animation:pulseGlow 2.5s infinite alternate;
}
@keyframes pulseGlow{
  0%{ box-shadow:0 0 35px rgba(255,0,0,.4); }
  50%{ box-shadow:0 0 55px rgba(255,0,0,.7); }
  100%{ box-shadow:0 0 40px rgba(255,0,0,.5); }
}
.card img{
  width:100%;
  border-radius:18px;
  margin-bottom:1rem;
  transform:perspective(900px) rotateX(7deg);
  transition:.4s;
}
.card:hover img{
  transform:perspective(900px) rotateX(0deg) scale(1.05);
}
.card h3{
  font-size:1.5rem;
  margin-bottom:0.5rem;
}
.card p{
  opacity:.85;
  line-height:1.6;
}

/* GLOW ANIMATION WHEN REFERRAL ADDED */
.glow{
  animation:flashGlow 1.5s ease-in-out 2;
}
@keyframes flashGlow{
  0%,100%{ box-shadow:0 15px 45px rgba(0,0,0,.5); }
  50%{ box-shadow:0 20px 60px rgba(255,0,0,.9); }
}

/* LEADERBOARD TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:2rem;
  background:rgba(255,255,255,.05);
  backdrop-filter:blur(15px);
  border-radius:15px;
  overflow:hidden;
}
th, td{
  padding:1rem;
  text-align:left;
}
th{
  background:rgba(255,0,0,.5);
  color:#fff;
}
tr:nth-child(even){background:rgba(255,255,255,.03);}
</style>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div class="hero">
  <h1>Ambassador Dashboard ⚽</h1>
  <p>Track your referrals, earnings, and climb the Max Soccer leaderboard!</p>
  <div class="wallet">Wallet Balance: $<span id="walletBalance">0.00</span></div>
</div>

<!-- REFERRAL & STATS GRID -->
<section class="grid" id="ambassadorGrid">
  <!-- Cards populated dynamically -->
</section>

<!-- LEADERBOARD -->
<section style="max-width:1200px;margin:auto;padding:2rem 1rem;">
  <h2 style="text-align:center;color:#ff0000;margin-bottom:1.5rem;">Top Ambassadors</h2>
  <table id="leaderboard">
    <thead>
      <tr>
        <th>Rank</th>
        <th>Email</th>
        <th>Wallet ($)</th>
        <th>Referrals</th>
      </tr>
    </thead>
    <tbody>
      <!-- dynamically populated -->
    </tbody>
  </table>
</section>

<script>
const supabaseUrl = "https://iotraxlicmdyybtgmkwm.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvdHJheGxpY21keXlidGdta3dtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNTA1OTAsImV4cCI6MjA4MzkyNjU5MH0.f69kiDeO7h0RPwRhSzINFoiVRRFjDB_CYk4nbhl2zBA";
const supabase = supabaseJs.createClient(supabaseUrl, supabaseKey);

let walletEl = document.getElementById("walletBalance");
let ambassadorGrid = document.getElementById("ambassadorGrid");
let leaderboardBody = document.querySelector("#leaderboard tbody");

// Load current ambassador wallet and referrals
async function loadAmbassadorDashboard(){
  const { data: user } = await supabase.auth.getUser();
  const userId = user.user.id;

  // Fetch ambassador profile
  const { data: profile } = await supabase.from("profiles").select("*").eq("id", userId).single();

  // Update wallet
  walletEl.textContent = profile.wallet.toFixed(2);

  // Load referral stats dynamically
  const { data: referrals } = await supabase.from("referrals").select("*").eq("ambassador_id", userId).order("created_at",{ascending:false});

  ambassadorGrid.innerHTML = "";
  referrals.forEach(ref=>{
    const card = document.createElement("div");
    card.classList.add("card","glow");
    card.innerHTML = `
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/0c/Soccer_ball.svg" alt="Referral">
      <h3>${ref.referred_email}</h3>
      <p>Joined: ${new Date(ref.created_at).toLocaleDateString()}</p>
      <p>Earned: $${ref.amount.toFixed(2)}</p>
    `;
    ambassadorGrid.appendChild(card);
    setTimeout(()=>card.classList.remove("glow"),1500);
  });

  // Load leaderboard
  const { data: leaderboard } = await supabase.from("profiles")
    .select("email,wallet")
    .eq("role","ambassador")
    .order("wallet",{ascending:false})
    .limit(10);

  leaderboardBody.innerHTML = "";
  leaderboard.forEach((row,i)=>{
    leaderboardBody.innerHTML += `
      <tr>
        <td>${i+1}</td>
        <td>${row.email}</td>
        <td>${row.wallet.toFixed(2)}</td>
        <td><!-- optional: count referrals per ambassador --></td>
      </tr>
    `;
  });
}

// Real-time wallet update
supabase.channel('public:profiles')
  .on('postgres_changes',{event:'UPDATE', schema:'public', table:'profiles'}, payload=>{
    const updated = payload.new;
    const user = supabase.auth.getUser();
    user.then(u=>{
      if(u.user.id === updated.id){
        walletEl.textContent = updated.wallet.toFixed(2);
      }
    });
  }).subscribe();

// Initialize dashboard
loadAmbassadorDashboard();
</script>

</body>
</html>