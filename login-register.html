<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Max Soccer ⚽ | Login & Register</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Orbitron',sans-serif;}
body{
  background:radial-gradient(circle at top,#1b1f4b,#070a1f);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

/* MODAL */
.modal{
  background:rgba(0,0,0,.7);
  padding:3rem 2rem;
  border-radius:25px;
  backdrop-filter:blur(15px);
  box-shadow:0 0 50px rgba(255,0,0,.7);
  max-width:450px;
  width:100%;
  text-align:center;
  animation:fadeIn .6s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(-30px);}
  to{opacity:1;transform:translateY(0);}
}

h1{
  color:#ff0000;
  text-shadow:0 0 15px rgba(255,0,0,.8);
}
p{opacity:.85;margin:1rem 0 2rem;}

.tabs{
  display:flex;
  justify-content:center;
  margin-bottom:2rem;
}
.tab{
  padding:.8rem 2rem;
  cursor:pointer;
  border-bottom:2px solid transparent;
}
.tab.active{
  border-bottom:2px solid #ff4d4d;
  color:#ff4d4d;
}

form{display:none;flex-direction:column;gap:1rem;}
form.active{display:flex;}

input,select{
  padding:1rem;
  border-radius:15px;
  border:none;
  background:rgba(255,255,255,.05);
  color:#fff;
}
input:focus,select:focus{
  outline:none;
  box-shadow:0 0 20px rgba(255,0,0,.6);
}

button{
  padding:1rem;
  border-radius:50px;
  border:none;
  background:linear-gradient(135deg,#ff0000,#ff4d4d);
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
button:hover{
  transform:scale(1.05);
  box-shadow:0 0 45px rgba(255,0,0,.8);
}
</style>
</head>

<body>

<div class="modal">
  <h1>Max Soccer ⚽</h1>
  <p>Access VIP content or become an Ambassador</p>

  <div class="tabs">
    <div class="tab active" data-tab="login">Login</div>
    <div class="tab" data-tab="register">Register</div>
  </div>

  <!-- LOGIN -->
  <form id="loginForm" class="active">
    <input type="email" id="loginEmail" placeholder="Email" required>
    <input type="password" id="loginPassword" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>

  <!-- REGISTER -->
  <form id="registerForm">
    <input type="text" id="registerUsername" placeholder="Username" required>
    <input type="email" id="registerEmail" placeholder="Email" required>
    <input type="password" id="registerPassword" placeholder="Password" required>
    <select id="registerRole">
      <option value="user">VIP Subscriber</option>
      <option value="ambassador">Ambassador</option>
    </select>
    <button type="submit">Register</button>
  </form>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

// ✅ YOUR SUPABASE PROJECT
const supabase = createClient(
  "https://iotraxlicmdyybtgmkwm.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvdHJheGxpY21keXlidGdta3dtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNTA1OTAsImV4cCI6MjA4MzkyNjU5MH0.f69kiDeO7h0RPwRhSzINFoiVRRFjDB_CYk4nbhl2zBA"
);

// ---------- TAB SWITCH ----------
document.querySelectorAll(".tab").forEach(tab=>{
  tab.onclick = ()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
    document.querySelectorAll("form").forEach(f=>f.classList.remove("active"));
    tab.classList.add("active");
    document.getElementById(tab.dataset.tab+"Form").classList.add("active");
  }
});

// ---------- SESSION PERSISTENCE ----------
const session = await supabase.auth.getSession();
if(session.data.session){
  redirectUser(session.data.session.user.id);
}

// ---------- REGISTER ----------
registerForm.onsubmit = async(e)=>{
  e.preventDefault();

  const username = registerUsername.value;
  const email = registerEmail.value;
  const password = registerPassword.value;
  const role = registerRole.value;

  const { data, error } = await supabase.auth.signUp({ email, password });
  if(error) return alert(error.message);

  const promoCode = "MAX-" + username.toUpperCase() + "-" + Math.floor(1000 + Math.random()*9000);

  await supabase.from("users").insert({
    id: data.user.id,
    username,
    role,
    promo_code: promoCode,
    wallet_balance: 0
  });

  redirectUser(data.user.id);
};

// ---------- LOGIN ----------
loginForm.onsubmit = async(e)=>{
  e.preventDefault();
  const { data, error } = await supabase.auth.signInWithPassword({
    email: loginEmail.value,
    password: loginPassword.value
  });
  if(error) return alert(error.message);
  redirectUser(data.user.id);
};

// ---------- ROLE REDIRECT ----------
async function redirectUser(userId){
  const { data } = await supabase
    .from("users")
    .select("role")
    .eq("id", userId)
    .single();

  if(data.role === "ambassador"){
    window.location.href = "ambassador.html";
  } else {
    window.location.href = "VIP.html";
  }
}
</script>

</body>
</html>