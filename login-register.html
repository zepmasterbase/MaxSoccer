<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Max Soccer ⚽ | Login & Register</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Orbitron',sans-serif}
body{
  background:radial-gradient(circle at top,#1b1f4b,#070a1f);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

/* MODAL */
.modal{
  background:rgba(0,0,0,.7);
  padding:3rem 2.5rem;
  border-radius:25px;
  backdrop-filter:blur(15px);
  box-shadow:0 0 50px rgba(255,0,0,.7);
  max-width:450px;
  width:100%;
  text-align:center;
  animation:fadeIn .6s ease;
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(-30px)}
  to{opacity:1;transform:translateY(0)}
}

h1{
  color:#ff0000;
  text-shadow:0 0 15px rgba(255,0,0,.8);
}
p{opacity:.85;margin:1.2rem 0 2rem}

/* FORM */
form{
  display:flex;
  flex-direction:column;
  gap:1.2rem;
}
input, select{
  padding:1rem;
  border-radius:15px;
  border:none;
  background:rgba(255,255,255,.06);
  color:#fff;
  font-size:1rem;
  outline:none;
}
input:focus, select:focus{
  box-shadow:0 0 20px rgba(255,0,0,.6);
}

button{
  padding:1rem;
  border:none;
  border-radius:50px;
  background:linear-gradient(135deg,#ff0000,#ff4d4d);
  color:#fff;
  font-weight:700;
  cursor:pointer;
  font-size:1.1rem;
  transition:.3s;
}
button:hover{
  transform:scale(1.05);
  box-shadow:0 0 40px rgba(255,0,0,.8);
}

.hidden{display:none}
footer{margin-top:2rem;font-size:.85rem;opacity:.6}
</style>
</head>

<body>

<div class="modal">
  <h1>Max Soccer ⚽</h1>
  <p>Login or register with your phone number</p>

  <!-- PHONE FORM -->
  <form id="phoneForm">
    <input type="tel" id="phone" placeholder="+2348012345678" required>
    <select id="role">
      <option value="user">VIP SUBSCRIBER</option>
      <option value="ambassador">AMBASSADOR</option>
    </select>
    <button type="submit">Send OTP</button>
  </form>

  <!-- OTP FORM -->
  <form id="otpForm" class="hidden">
    <input type="text" id="otp" placeholder="Enter OTP code" required>
    <button type="submit">Verify & Continue</button>
  </form>

  <footer>© 2026 Max Soccer ⚽</footer>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabase = createClient(
  'https://iotraxlicmdyybtgmkwm.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlvdHJheGxpY21keXlidGdta3dtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgzNTA1OTAsImV4cCI6MjA4MzkyNjU5MH0.f69kiDeO7h0RPwRhSzINFoiVRRFjDB_CYk4nbhl2zBA'
)

const phoneForm = document.getElementById('phoneForm')
const otpForm = document.getElementById('otpForm')
let currentPhone = ''
let selectedRole = 'user'

/* SEND OTP */
phoneForm.addEventListener('submit', async (e)=>{
  e.preventDefault()
  currentPhone = document.getElementById('phone').value
  selectedRole = document.getElementById('role').value

  const { error } = await supabase.auth.signInWithOtp({
    phone: currentPhone
  })

  if(error){ alert(error.message); return }

  phoneForm.classList.add('hidden')
  otpForm.classList.remove('hidden')
})

/* VERIFY OTP */
otpForm.addEventListener('submit', async (e)=>{
  e.preventDefault()
  const token = document.getElementById('otp').value

  const { data, error } = await supabase.auth.verifyOtp({
    phone: currentPhone,
    token,
    type: 'sms'
  })

  if(error){ alert(error.message); return }

  const user = data.user

  // Check if profile exists
  const { data: profile } = await supabase
    .from('users')
    .select('*')
    .eq('id', user.id)
    .single()

  if(!profile){
    const promo = selectedRole === 'ambassador'
      ? `MAX-${Math.random().toString(36).substring(2,8).toUpperCase()}`
      : null

    await supabase.from('users').insert({
      id: user.id,
      phone: currentPhone,
      role: selectedRole,
      promo_code: promo,
      wallet_balance: 0
    })
  }

  // Redirect
  if(selectedRole === 'ambassador'){
    window.location.href = 'ambassador.html'
  }else{
    window.location.href = 'VIP.html'
  }
})
</script>

</body>
</html>